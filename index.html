<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animated Vocabulary Quiz</title>
<style>
body { font-family:"Segoe UI",Arial,sans-serif; margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background-size:cover; background-position:center; transition: background 1s ease-in-out; }
.quiz-container { background:#fff; padding:30px; border-radius:16px; box-shadow:0 10px 20px rgba(0,0,0,0.3); width:90%; max-width:700px; text-align:center; position:relative; overflow:hidden; transition: transform 0.5s ease, opacity 0.5s ease;}
.quiz-container.animate-slide { transform: translateX(100%); opacity:0; }
.score { font-size:18px; margin-bottom:15px;}
.question { font-size:22px; margin-bottom:20px; transition: transform 0.5s ease, opacity 0.5s ease; }
.options button { padding:12px; border:2px solid #007bff; border-radius:10px; background:#fff; cursor:pointer; width:100%; margin:6px 0; font-size:18px; transition:.25s;}
.options button:hover { background:#007bff; color:#fff;}
.feedback { margin-top:15px; font-size:18px; transition: opacity 0.5s ease;}
.new-word-form { margin-top:20px; display:flex; flex-direction:column; gap:10px; }
.new-word-form input, .new-word-form button { padding:8px; font-size:16px; border-radius:6px; border:1px solid #ccc;}
.new-word-form button { background:#28a745; color:#fff; border:none; cursor:pointer; transition:.3s;}
.new-word-form button:hover { background:#218838; }
</style>
</head>
<body>

<div class="quiz-container" id="quizContainer">
  <div class="score" id="score">Score: 0</div>
  <div class="question" id="question">Loading...</div>
  <div class="options" id="options"></div>
  <div class="feedback" id="feedback"></div>

  <div class="new-word-form">
    <input type="text" id="newWord" placeholder="Enter new word"/>
    <input type="text" id="newDef" placeholder="Optional definition"/>
    <button id="addWordBtn">Add Word</button>
  </div>
</div>

<script>
// Word bank sample
let WORDS = ["Facetious","Deliberately","Unhurried","Flippant","Waggish","Patronizing"];
let score = 0;

// Cached definitions
let definitionCache = JSON.parse(localStorage.getItem("definitionCache")||"{}");

// Unsplash backgrounds for theme cycling
const backgrounds = [
  "https://source.unsplash.com/1600x900/?nature,sky",
  "https://source.unsplash.com/1600x900/?books,library",
  "https://source.unsplash.com/1600x900/?abstract,art",
  "https://source.unsplash.com/1600x900/?technology,pattern",
  "https://source.unsplash.com/1600x900/?space,stars",
  "https://source.unsplash.com/1600x900/?ocean",
  "https://source.unsplash.com/1600x900/?city,night",
  "https://source.unsplash.com/1600x900/?forest",
];

// Utility shuffle
function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

// Fetch definition with caching
async function getDefinition(word){
  if(definitionCache[word]) return definitionCache[word];
  try{
    const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
    const data = await res.json();
    const def = data?.[0]?.meanings?.[0]?.definitions?.[0]?.definition || "Definition not found.";
    definitionCache[word]=def;
    localStorage.setItem("definitionCache", JSON.stringify(definitionCache));
    return def;
  }catch(e){ return "Definition not found."; }
}

// Animate question card
function animateCard(callback){
  const card = document.getElementById("quizContainer");
  card.classList.add("animate-slide");
  setTimeout(()=>{
    callback();
    card.classList.remove("animate-slide");
  }, 500);
}

// Change background smoothly
function changeTheme(){
  const newBg = backgrounds[Math.floor(Math.random()*backgrounds.length)];
  const img = new Image();
  img.src = newBg;
  img.onload = () => document.body.style.backgroundImage = `url(${newBg})`;
}

// Generate a random question
async function generateQuestion(){
  document.getElementById("feedback").style.opacity = 0;
  const word = WORDS[Math.floor(Math.random()*WORDS.length)];
  const definition = await getDefinition(word);
  const mode = Math.random()<0.5 ? "hidden" : "definition"; // hidden word or definition
  let prompt, correct, choices;

  if(mode==="hidden"){
    prompt = `[HIDDEN WORD] in a sentence: ${definition}`;
    correct = word;
    choices = shuffle([
      correct,
      WORDS[Math.floor(Math.random()*WORDS.length)],
      WORDS[Math.floor(Math.random()*WORDS.length)],
      WORDS[Math.floor(Math.random()*WORDS.length)]
    ]);
  } else {
    prompt = definition;
    correct = word;
    choices = shuffle([
      correct,
      WORDS[Math.floor(Math.random()*WORDS.length)],
      WORDS[Math.floor(Math.random()*WORDS.length)],
      WORDS[Math.floor(Math.random()*WORDS.length)]
    ]);
  }

  animateCard(()=>{
    document.getElementById("question").innerText = prompt;
    const optsDiv = document.getElementById("options");
    optsDiv.innerHTML = "";
    choices.forEach(choice=>{
      const btn = document.createElement("button");
      btn.textContent = choice;
      btn.onclick = ()=>checkAnswer(choice, correct);
      optsDiv.appendChild(btn);
    });
    changeTheme();
  });
}

// Check answer
function checkAnswer(choice, correct){
  const feedback = document.getElementById("feedback");
  if(choice===correct){
    score++;
    feedback.style.color="green";
    feedback.innerText="Correct!";
  } else {
    feedback.style.color="red";
    feedback.innerText=`Incorrect â€” correct: ${correct}`;
  }
  feedback.style.opacity = 1;
  document.getElementById("score").innerText=`Score: ${score}`;
  setTimeout(generateQuestion,1200);
}

// Add new word
document.getElementById("addWordBtn").addEventListener("click", async ()=>{
  const newWord = document.getElementById("newWord").value.trim();
  let newDef = document.getElementById("newDef").value.trim();
  if(!newWord) return alert("Enter a word");
  if(!WORDS.includes(newWord)) WORDS.push(newWord);
  if(!newDef) newDef = await getDefinition(newWord);
  definitionCache[newWord]=newDef;
  localStorage.setItem("definitionCache", JSON.stringify(definitionCache));
  alert(`Word "${newWord}" added successfully!`);
  document.getElementById("newWord").value="";
  document.getElementById("newDef").value="";
});

// Start the game
generateQuestion();
</script>
</body>
</html>
